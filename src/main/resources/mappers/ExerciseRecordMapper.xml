<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.otd.otd_msa_back_life.exercise.mapper.ExerciseRecordMapper">

    <!-- 운동기록 리스트 조회-->
    <select id="findByLimitTo">
        SELECT exercise_record_id, exercise_id, activity_kcal, effort_level, start_at, end_at, duration, distance, reps
        FROM exercise_record
        WHERE user_id = #{userId}
        <if test="type == 'daily' and date != null">
            AND DATE(start_at) = #{date}
        </if>
        <if test="type == 'monthly' and date != null">
            AND DATE_FORMAT(start_at, '%Y-%m') = #{date}
        </if>
        ORDER BY start_at DESC
        LIMIT #{startIdx}, #{size};
    </select>


    <select id="findAverageDurationGroupedByDate" resultType="com.otd.otd_msa_back_life.exercise.model.AverageExerciseDurationDto">
        SELECT
        DATE(start_at) AS date,
        ROUND(AVG(duration), 2) AS averageDuration
        FROM exercise_record
        GROUP BY DATE(start_at)
        ORDER BY DATE(start_at)
    </select>

</mapper>